{% extends 'base.html' %}
{% load static %}
{% load materializecss %}
{% load hitcount_tags %}
{% load humanize %}

{% block content %}
<div class="row">

<div class="col s12 l8">
<h4 class="purple-text text-darken-3">{{ post.title|title }}</h4>
  <div class="section">
    <img class="materialboxed responsive-img" src="{{ post.image.url }}">
  </div>

<div class="valign-wrapper grey-text">

  <img src="{{ post.creator.userprofile.avatar.url }}"
    width="50" height="50"
    alt="{{post.creator.userprofile.name}} avatar"
    class="circle responsive-img">
      <span>&nbsp;&nbsp;{{ post.creator.userprofile.name }}&nbsp;&#8226;
      <span>&nbsp;{{ post.added|timesince }} ago &nbsp;&#8226;</span>
      <span>&nbsp;{{ post.body|wordcount }} words&nbsp;&#8226;</span>
      <span>&nbsp;{% get_hit_count for post %} views</span>
</div>

<hr class="grey-text text-lighten-4">
<p class="">{{ post.body|linebreaks }}</p>
</div>
</div>
<div class="row">

  <div class="col s12 l8">
    <hr class="grey-text text-lighten-3">
<h3 class="purple-text text-darken-3">Comments
    
</h3>
  <div id="comment-form">
    {% if user.is_authenticated %}
    <span><button class="btn btn-small blue wave-effects" hx-get="{% url 'posts:comment' post.slug %}"
            hx-target="#comment-form"
            hx-swap="outerHTML"
            >
    Leave a comment
    </button></span>
    {% endif %}
  </div>
  <div id="" class="section">
      <ul class="comment-list">
      {% for comment in post.comments %}
       
      <div class="col s12">
        <div class="card-panel grey lighten-4 z-depth-0">
          <div class="row valign-wrapper">
            <div class="col s2">
              <img src="{{ comment.user.userprofile.avatar.url }}" alt="" class="circle responsive-img"> <!-- notice the "circle" class -->
            </div>
            <div class="col s10">
                <span class="black-text"><b>{{ comment.user }}</b></span>
                <span class="grey-text">&nbsp;&#8226;&nbsp;{{ comment.added|timesince }} ago</span>
              <p class="">
                 {{ comment.comment }}
              </p>
            </div>
          </div>
        </div>
      </div>
      
      {% endfor %}
    </ul>
  </div>
  </div>
</div>

<div id="sidebar-right" class="col s12 l4">
  {% if popular_posts %}
    {% include 'posts/_popular_posts.html' %}
  {% endif %}
</div>
<div id="sidebar-right" class="col s12 l4">
  {% if recent_posts %}
    {% include 'posts/_recent_posts.html' %}
  {% endif %}
</div>

{% if user.is_authenticated and post.creator == user %}
<!-- floating action buttons for post -->
<div class="fixed-action-btn">
  <a class="btn-floating btn-large purple darken-3">
    <i class="large material-icons">edit</i>
  </a>
  <ul>
    <li><a class="btn-floating yellow darken-1"><i class="material-icons">sms</i></a></li>
    <li><a href="#post-delete-modal" class="btn-floating modal-trigger red"><i class="material-icons">delete</i></a></li>
    <li><a href="{% url 'posts:update' post.slug %}" class="btn-floating modal-trigger blue">
        <i class="material-icons">edit</i></a>
      </li>
  </ul>
</div>
<!--  End floating action buttons -->
{% endif %}

 <!-- delete post Modal -->
 <div id="post-delete-modal" class="modal">
  <div class="modal-content">
    <H5 class="flow-text purple-text darken-3"">Delete Post</H5>
    <p class="">Are you sure you want to delete this post
        <span class="teal-text"> {{ post.title }}</span></p>

        <form action="{% url 'posts:delete' post.slug %}" method='POST' class="col s12">
            {% csrf_token %}
            <button class="btn waves-effect waves-light red center"
                type="submit" name="action">Yes, Delete
                <i class="material-icons left">delete</i>
            </button>
        </form>
    </div>
  <div class="modal-footer">
    <a href="#!" class="modal-close waves-effect waves-green btn-flat">
      Cancel</a>
  </div>
</div>
<!-- end modal -->    
{% endblock content %}

{% block script %}
<script>
    // init materialize css boxed img
    document.addEventListener('DOMContentLoaded', function() {
      let mboxed = document.querySelectorAll('.materialboxed')
      let instances = M.Materialbox.init(mboxed, {})
    })
</script>

{% endblock script %}